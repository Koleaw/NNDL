
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Telco Churn — EDA v2 (Deep)</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.5.1/dist/tfjs-vis.umd.min.js"></script>
  <style>
    :root{--bg:#0e1124;--card:#171a2f;--text:#e7ebff;--muted:#a8b0d9;--border:#2a2f52}
    *{box-sizing:border-box} body{margin:0;background:radial-gradient(1200px 800px at 20% -10%,#1a2050,var(--bg));color:var(--text);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:1240px;margin:24px auto 90px;padding:0 16px} header{display:flex;gap:16px;align-items:center;margin-bottom:16px}
    .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#5aa9ff,#a855f7);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800}
    h1{margin:0;font-size:20px}.hint{color:var(--muted);margin-top:-2px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--border);border-radius:16px;padding:16px}
    .card h2{margin:0 0 10px;font-size:16px}.sub{color:var(--muted);margin:2px 0 10px}
    .cols-6{grid-column:span 6}.cols-4{grid-column:span 4}.cols-8{grid-column:span 8}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted);background:rgba(255,255,255,.03);margin:0 6px 6px 0}
    table{width:100%;border-collapse:collapse;border:1px solid var(--border);border-radius:10px;overflow:hidden}
    th,td{padding:8px 10px;border-bottom:1px solid var(--border)} th{text-align:left;color:var(--muted);background:rgba(255,255,255,.03)} tr:last-child td{border-bottom:none}
    .surfaces{display:grid;grid-template-columns:repeat(3,1fr);gap:12px} .surface{min-height:260px;border:1px dashed var(--border);border-radius:12px;padding:8px}
    .btn{appearance:none;border:1px solid var(--border);color:var(--text);background:rgba(255,255,255,.03);padding:8px 12px;border-radius:12px;cursor:pointer}
    .bullets{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:8px}
    @media(max-width:1000px){.cols-6,.cols-8,.cols-4{grid-column:span 12}.surfaces{grid-template-columns:1fr}}
    code{color:#c8d9ff}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">AI</div>
      <div>
        <h1>Telco Customer Churn — EDA v2 (deeper, ready for midterm)</h1>
        <div class="hint">Upload CSV → full audit: shapes, dtypes, missing, duplicates, distributions, associations, segments, class weights.</div>
      </div>
    </header>

    <div class="grid">
      <section class="card cols-12">
        <h2>1) Data Load</h2>
        <div class="sub">Pick the CSV and click Load.</div>
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <input id="fileInput" type="file" accept=".csv,text/csv"/>
          <button class="btn" id="loadBtn">Load CSV</button>
          <span id="loadStatus" class="pill">Waiting for file…</span>
        </div>
      </section>

      <section class="card cols-6">
        <h2>2) Shapes, Columns & Dtypes</h2>
        <div id="shapes"></div>
        <div id="typesTable" style="margin-top:8px;"></div>
      </section>

      <section class="card cols-6">
        <h2>3) Duplicates & Quality Checks</h2>
        <div id="quality"></div>
      </section>

      <section class="card cols-12">
        <h2>4) Missing Values</h2>
        <div id="missingTable"></div>
      </section>

      <section class="card cols-12">
        <h2>5) Distributions (numeric)</h2>
        <div class="surfaces">
          <div class="surface" id="histTenure"></div>
          <div class="surface" id="histMonthly"></div>
          <div class="surface" id="histTotal"></div>
        </div>
        <div id="numSummary" style="margin-top:8px;"></div>
      </section>

      <section class="card cols-12">
        <h2>6) Churn Insights (categorical & bins)</h2>
        <div class="surfaces">
          <div class="surface" id="chartBalance"></div>
          <div class="surface" id="chartContract"></div>
          <div class="surface" id="chartInternet"></div>
        </div>
        <div class="surfaces" style="margin-top:8px;">
          <div class="surface" id="chartSenior"></div>
          <div class="surface" id="chartPaperless"></div>
          <div class="surface" id="chartPayment"></div>
        </div>
      </section>

      <section class="card cols-12">
        <h2>7) Associations with Churn</h2>
        <div class="sub">Numeric: point-biserial correlation | Categorical: Cramér’s V</div>
        <div id="assocTable"></div>
      </section>

      <section class="card cols-12">
        <h2>8) Top Risk Segments (Contract × Tenure bins)</h2>
        <div id="segmentsTable"></div>
      </section>

      <section class="card cols-12">
        <h2>9) Class Imbalance & Recommended class weights</h2>
        <div id="imbalance"></div>
      </section>

      <section class="card cols-12">
        <h2>10) Auto Summary & Export</h2>
        <div id="summaryBullets" class="bullets"></div>
        <div style="margin-top:8px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <button class="btn" id="downloadJson">Download EDA summary (JSON)</button>
        </div>
      </section>
    </div>
  </div>

  <script>
    const el=(t,p={},...kids)=>{const n=document.createElement(t);Object.assign(n,p);kids.forEach(k=>n.append(k?.nodeType?k:document.createTextNode(k??'')));return n};
    const clear=n=>{while(n.firstChild)n.removeChild(n.firstChild)};
    const fmtPct=x=>(isFinite(x)?(x*100).toFixed(1)+'%':'—');

    function table(container, rows, cols){
      clear(container);
      const tbl=el('table'), thead=el('thead'), trh=el('tr');
      cols.forEach(c=>trh.appendChild(el('th',{},c))); thead.appendChild(trh); tbl.appendChild(thead);
      const tb=el('tbody');
      rows.forEach(r=>{const tr=el('tr'); cols.forEach(c=>tr.appendChild(el('td',{},String(r[c]??'')))); tb.appendChild(tr);});
      tbl.appendChild(tb); container.appendChild(tbl);
    }
    function renderBar(container, dataXY, opts={}){
      const data=dataXY.map(d=>({index:String(d.x), value:Number(d.y)}));
      const options=Object.assign({xLabel:'Category', yLabel:'Value', yAxisDomain:[0,1], height:260}, opts);
      clear(container); tfvis.render.barchart(container, data, options);
    }
    function renderHist(container, values, bins=20){
      const v=values.filter(x=>isFinite(x)); if(!v.length){ clear(container); container.textContent='No data'; return; }
      const min=Math.min(...v), max=Math.max(...v);
      const step=(max-min)/bins || 1;
      const counts=new Array(bins).fill(0);
      v.forEach(x=>{ let idx=Math.floor((x-min)/step); if(idx>=bins) idx=bins-1; if(idx<0) idx=0; counts[idx]++; });
      const data=counts.map((c,i)=>({x:(min+i*step).toFixed(1), y:c/v.length}));
      renderBar(container, data, {xLabel:'Value (bin start)', yLabel:'Share', yAxisDomain:[0,Math.max(...data.map(d=>d.y))*1.2]});
    }
  </script>
</body>
</html>
